<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>潛水氣瓶統計系統</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
        }

        h2 {
            text-align: center;
        }

        .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .button-container button {
            width: 48%;
            padding: 10px 20px;
            margin-bottom: 10px;
            border: none;
            border-radius: 5px;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
            box-sizing: border-box;
        }

        .button-container button.selected {
            background-color: #28a745;
        }

        .confirm-button {
            display: block;
            margin: 20px auto;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: red;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
            line-height: 100px;
        }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        #summary {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>

<body>

<div class="container">
    <h2>潛水氣瓶統計系統</h2>

    <div class="button-container" id="memberButtons">
        <!-- 成員按鈕將在這裡動態生成 -->
    </div>

    <!-- 紅色圓形按鈕 -->
    <button class="confirm-button" onclick="generateSummary()">行程出單</button>

    <h3>每日氣瓶使用情況</h3>
    <table>
        <thead>
            <tr>
                <th>成員</th>
                <th>第1天</th>
                <th>第2天</th>
                <th>第3天</th>
                <th>第4天</th>
                <th>第5天</th>
                <th>第6天</th>
                <th>第7天</th>
            </tr>
        </thead>
        <tbody id="usageTable">
            <!-- 這裡會自動填充成員使用數據 -->
        </tbody>
    </table>

    <h3 id="summary"></h3>
</div>

<script>
    // 初始化成員列表與使用紀錄
    const team = ["小妤姐", "欣莤", "丁", "蚊子", "小劉哥", "小畢", "巫主任", "小兔", "阿仁", "阿凱", "柏祥", "伯倫", "康康", "豆桑", "新成員A", "新成員B"];
    const usageLog = {};
    const selectedMembers = {}; // 用來儲存被選中的成員

    // 初始化每位成員的使用紀錄
    team.forEach(member => {
        usageLog[member] = [0, 0, 0, 0, 0, 0, 0]; // 每天的氣瓶使用量，初始為0
        selectedMembers[member] = false; // 初始化所有成員都未選中
    });

    // 生成成員按鈕
    function generateMemberButtons() {
        const container = document.getElementById("memberButtons");
        container.innerHTML = ''; // 清空容器
        team.forEach(member => {
            const button = document.createElement("button");
            button.innerText = member;
            button.onclick = () => handleMemberButtonClick(member, button);
            container.appendChild(button);
        });
    }

    // 按鈕點擊處理函數
    function handleMemberButtonClick(member, button) {
        const today = new Date();
        const day = today.getDate() % 7; // 假設我們根據當前日期，來決定氣瓶紀錄的第幾天
        if (button.classList.contains("selected")) {
            if (confirm(`確定要取消 ${member} 的登記嗎？`)) {
                button.classList.remove("selected");
                selectedMembers[member] = false; // 取消選擇
                usageLog[member][day - 1] -= 1; // 減少當天的氣瓶數量
                alert(`${member} 的登記已取消。`);
            }
        } else {
            button.classList.add("selected");
            selectedMembers[member] = true; // 設置成員已選
            usageLog[member][day - 1] += 1; // 默認當前時間，氣瓶數量增加1
            alert(`${member} 已登記，當前時間為：${today.toLocaleString()}，氣瓶數量+1。`);
        }
        updateUsageTable(); // 更新表格
    }

    // 更新使用紀錄表格
    function updateUsageTable() {
        const tableBody = document.getElementById("usageTable");
        tableBody.innerHTML = ''; // 清空表格
        team.forEach(member => {
            if (usageLog[member].some(count => count > 0)) {
                let row = `<tr><td>${member}</td>`;
                for (let i = 0; i < 7; i++) {
                    row += `<td>${usageLog[member][i]}</td>`;
                }
                row += `</tr>`;
                tableBody.innerHTML += row;
            }
        });
    }

    // 行程出單按鈕功能：生成統計摘要，並允許分享到Line
    function generateSummary() {
        const today = new Date();
        const selectedCount = Object.values(selectedMembers).filter(selected => selected).length;
        const dateString = today.toLocaleDateString();

        if (selectedCount > 0) {
            const summaryMessage = `行程總人數: ${selectedCount} 人\n日期: ${dateString}`;
            alert(summaryMessage); // 顯示行程總人數及日期
            
            // 分享到Line
            const lineShareUrl = `https://line.me/R/msg/text/?${encodeURIComponent(summaryMessage)}`;
            window.open(lineShareUrl, '_blank');
        } else {
            alert("尚未選擇任何成員！");
        }
    }

    // 初始化頁面時生成成員按鈕並更新表格
    generateMemberButtons();
    updateUsageTable();
</script>

</body>
</html>
